version: '3'
services:
  # Web service layer
  # nginx:
  #   image: nginx:1.13
  #   volumes:
  #     - '.:/var/www/html'
  #     - './nginx/nginx.conf:/etc/nginx/nginx.conf'
  #   container_name: server_nginx
  #   ports:
  #     - '80:80'
  #   depends_on:
  #     - php

  # Application service layer
  php:
    build:
      context: ./php
    volumes:
      - '.:/var/www/html/'
    container_name: server_php
    command: php -S 0.0.0.0:9000 -t public/
    ports:
      - '9000:9000'
    depends_on:
      - mysql
    environment:
      - MYSQL_USER=root
      - MYSQL_PASS=bwUh3DtN3e32ttya

  # # Data persistence service layer
  mysql:
     image: mysql:5.7.20
     volumes:
       - 'db_data:/var/lib/mysql'
       - './mysql/initial_data:/docker-entrypoint-initdb.d'
     container_name: server_mysql
     ports:
       - '3306:3306'
     environment:
       - MYSQL_ROOT_PASSWORD=bwUh3DtN3e32ttya

volumes:
  db_data:
